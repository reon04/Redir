<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Redir</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow">
      <div class="container-lg">
        <a class="navbar-brand" href="/">Redir</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-link active" aria-current="page" href="">Init</a>
          </div>
        </div>
      </div>
    </nav>
    <main class="container-lg">
      {% if request.args.get('suc') != None %}
      <div class="alert alert-success alert-dismissible fade show" data-timeout="5000">
        <strong>Success!</strong> {{ request.args.get('suc') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
      {% endif %}
      {% if request.args.get('err') != None %}
      <div class="alert alert-danger alert-dismissible fade show" data-timeout="5000">
        <strong>Error!</strong> {{ request.args.get('err') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
      {% endif %}
      <div class="mb-3 p-3 text-black bg-warning rounded shadow">
        <h4 class="mb-2 pb-2 border-bottom border-secondary">DB Initialization</h4>
        <p class="mb-3">The database "{{database_name}}" needs to be initialized because the table "{{table_name}}" and / or the function "{{function_name}}" was not found in it. Please note that this operation does not override an existing table or function. If another table or function with the same name is already in use in this database, consider creating a new database and specifying its name via the respective environment variable.</p>
        <button type="button" class="btn btn-primary" id="initBtn">Init DB</button>
      </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script type="text/javascript">
      document.querySelectorAll('.alert').forEach(function(alert) {
          new bootstrap.Alert(alert);
          setTimeout(() => {
              bootstrap.Alert.getInstance(alert).close();
          }, +alert.getAttribute('data-timeout'));
      });
    </script>
    <script type="text/javascript">
      initBtn.onclick = async function () {
        data = {'action': "init"}
        const response = await fetch("/config", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });
        data = await response.json()
        if (data['result'] == "success") window.location.replace(`/?suc=${data['message']}`);
        if (data['result'] == "error") window.location.replace(`/?err=${data['message']}`);
      };
    </script>
  </body>
</html>